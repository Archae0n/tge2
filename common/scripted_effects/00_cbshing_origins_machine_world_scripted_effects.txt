# by cbshing
#	Example:
#
#	example_effect = {
#		add_energy = -100
#	}
#
#
#	In a script file:
#
#	effect = {
#		example_effect = yes
#	}
#

reset_start_buildings_and_blockers_machine_world = { #Selectively resets necessary tiles for Machine World Civic users. Is triggered after "generate_start_buildings_and_blockers" by cbshing_origins_machine_world_start.1
	# Find capitol and buildings, and then remove them
	# this is needed because planet's deposits were re-rolled after
	every_tile = {
		limit = { has_building = yes }
		remove_building = yes
	}
	# Set up a new capitol and nearby buildings
	random_tile = {
		limit = { has_blocker = no has_building = no num_adjacent_tiles > 3 }
		set_building = "building_machine_capital_1"
		set_deposit = d_energy_deposit	
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_power_plant_1"
			clear_deposits = yes						
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_power_plant_1"
			clear_deposits = yes						
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_power_plant_1"
			set_deposit = d_rich_energy_deposit
		}
		random_neighboring_tile = {
			limit = { has_blocker = no has_building = no }
			set_building = "building_mining_network_1"
			set_deposit = d_rich_mineral_deposit
		}
	}
	
	# Add the lab
	# has pop = yes to make sure they use the tiles that were first generated for this task
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = yes  }
		set_building = "building_basic_science_lab_1"
		random_list = {
			33 = {
				set_deposit = d_engineering_deposit										
			}
			33 = { 
				set_deposit = d_society_deposit											
			}
			33 = { 
				set_deposit = d_physics_deposit											
			}					
		}	
	}
	# Add mine and power plant
	# has pop = yes to make sure they use the tiles that were first generated for this task
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = yes }
		set_building = "building_mining_network_1"
		set_deposit = d_mineral_deposit
	}
	random_tile = {
		limit = { has_blocker = no has_building = no has_pop = yes  }
		set_building = "building_power_plant_1"
		set_deposit = d_rich_energy_deposit
	}
	
	# Move pops to tiles
	every_tile = {
		limit = { has_building = yes has_pop = no }
		
		save_event_target_as = needs_worker	
		planet = {
			random_pop = {
				limit = { tile = { has_building = no } }

				resettle_pop = {
					pop = this
					tile = event_target:needs_worker
				}
			
			}		
		}
	}
	# Add blockers
	random_tile = {
        limit = { has_blocker = no has_building = no has_pop = no }
        set_blocker = "tb_failing_infrastructure"
        set_deposit = d_rich_energy_deposit
    }
    random_tile = {
        limit = { has_blocker = no has_building = no has_pop = no }
        set_blocker = "tb_failing_infrastructure"
        set_deposit = d_engineering_deposit
    }
    random_tile = {
        limit = { has_blocker = no has_building = no has_pop = no  }
        set_blocker = "tb_failing_infrastructure"
        set_deposit = d_society_deposit
    }
    random_tile = {
        limit = { has_blocker = no has_building = no has_pop = no }
        set_blocker = "tb_failing_infrastructure"
        set_deposit = d_physics_deposit
    }
}