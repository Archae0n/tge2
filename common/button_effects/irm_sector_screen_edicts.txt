# IRM
# Buttons for Sector Overview screen


# UI / EDICTS

# Edict - Capital
ui_cb_edict_capital_on = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_capital = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_capital.disallow"
			event_target:uiSectorCapital = { has_building = "building_sector_administration" }
		}		
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_capital.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictCapital value = @monthsEdictLength }
				}
			}
		}
	}
}
ui_cb_edict_capital_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_capital = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_capital.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_capital = no }
		}		
	}	
}

# Mining (Strategic resources)
ui_cb_edict_mining_on = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_mining = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}			
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_capital.disallow"
			event_target:uiSectorCapital = { has_building = "building_sector_administration" }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_mining.disallow"
			event_target:uiSectorCapital.sector = { sector_mines_strategic_resources = yes }
		}		
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_mining.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictMining value = @monthsEdictLength }
				}
			}
		}
	}		
}
ui_cb_edict_mining_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_mining = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_mining.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_mining = no }
		}		
	}
}

# Assets (orbital stations upkeep)
ui_cb_edict_assets_on = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_assets = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}			
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_assets.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictAssets value = @monthsEdictLength }
				}
			}
			every_mining_station = {
				limit = {
					solar_system.star = {
						event_target:uiSectorCapital.sector = {
							any_planet = {
								is_star = yes
								is_same_value = prevprev
							}
						}
					}
				}
				add_modifier = { modifier = mining_station_optimised days = @standardEdictLength }
			}
			every_research_station = {
				limit = {
					solar_system.star = {
						event_target:uiSectorCapital.sector = {
							any_planet = {
								is_star = yes
								is_same_value = prevprev
							}
						}
					}
				}
				add_modifier = { modifier = research_station_optimised days = @standardEdictLength }
			}
		}
	}		
}
ui_cb_edict_assets_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_assets = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_assets.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_assets = no }
		}		
	}
}

# Internal Colonization
ui_cb_edict_colony_on = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_colony = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}				
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_colony.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictColony value = @monthsEdictLength }
				}
			}			
		}
	}
}
ui_cb_edict_colony_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_colony = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_colony.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_colony = no }
		}		
	}	
}

# Trade
ui_cb_edict_trade_on = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_trade = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}				
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_trade.disallow.rel"
			event_target:uiSectorCapital.sector = {
				any_planet = {
					is_star = yes
					solar_system = {
						any_neighbor_system = {
							ignore_hyperlanes = yes
							exists = space_owner
							space_owner = {
								is_country_type = default
								not = { is_same_empire = event_target:uiSectorCapital.owner } # not this country
								nor = {
									# nothing should interrup the trade
									has_closed_borders = event_target:uiSectorCapital.owner
									event_target:uiSectorCapital.owner = { has_closed_borders = prev }
									is_rival = event_target:uiSectorCapital.owner
									event_target:uiSectorCapital.owner = { is_rival = prev }
									is_at_war_with = event_target:uiSectorCapital.owner
								}								
							}
						}
					}
				}
			}			
		}		
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_trade.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictTrade value = @monthsEdictLength }
				}
			}
		}
	}
}
ui_cb_edict_trade_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_trade = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_trade.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_trade = no }
		}		
	}
}


# Leadership Education
ui_cb_edict_leadership_on = {
	potential = {
		exists = event_target:uiSectorDatabase
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_leadership = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}				
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_capital.disallow"
			event_target:uiSectorCapital = { has_building = "building_sector_administration" }
		}
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_leadership.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictLeadership value = @monthsEdictLength }
				}
			}
		}
	}
}
ui_cb_edict_leadership_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_leadership = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_leadership.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_leadership = no }
		}		
	}
}

# Regionalism reduction
ui_cb_edict_propaganda_on = {
	potential = {
		exists = event_target:uiSectorDatabase
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_propaganda = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}				
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_propaganda.disallow"
			count_pop_factions = {
				limit = {
					is_pop_faction_type = "regionalist"
					check_pop_faction_parameter = { which = sector value = event_target:uiSectorCapital.sector }
				}
				count > 0
			}			
		}		
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_propaganda.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictPropaganda value = @monthsEdictLength }
				}
			}
		}
	}
}
ui_cb_edict_propaganda_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_propaganda = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_propaganda.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_propaganda = no }
		}		
	}
}

# Faction
ui_cb_edict_faction_on = {
	potential = {
		exists = event_target:uiSectorDatabase
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_faction = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}			
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_faction.disallow"
			or = {
				has_ethic = "ethic_gestalt_consciousness"
				count_pop_factions = {
					limit = {
						is_pop_faction_type = "regionalist"
						check_pop_faction_parameter = { which = sector value = event_target:uiSectorCapital.sector }
					}
					count > 0
				}
			}
		}
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_faction.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictFaction value = @monthsEdictLength }
				}
			}
			random_pop_faction = {
				limit = {
					is_pop_faction_type = "regionalist"
					check_pop_faction_parameter = { which = sector value = event_target:uiSectorCapital.sector }
				}
				add_modifier = { modifier = "faction_encouragement" days = @standardEdictLength }
			}
		}	
	}
}
ui_cb_edict_faction_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_faction = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_faction.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_faction = no }
		}		
	}
}

# Military Training
ui_cb_edict_training_on = {
	potential = {
		exists = event_target:uiSectorDatabase
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_training = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}				
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_training.disallow"
			event_target:uiSectorCapital.sector = {
				any_planet = {
					is_star = yes
					exists = starbase
					starbase = { has_starbase_module = shipyard }
				}
			}
		}
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_training.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictTraining value = @monthsEdictLength }
				}
			}
		}
	}
}
ui_cb_edict_training_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_training = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_training.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_training = no }
		}		
	}
}

# Anti Piracy
ui_cb_edict_piracy_on = {
	potential = {
		exists = event_target:uiSectorDatabase
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_piracy = no }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.lacking"
			event_target:uiSectorCapital.sector = { ui_has_edict_influence = yes }
		}
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict.systems"
			event_target:uiSectorCapital.sector = { sector_is_overextended = no }
		}				
	}
	effect = {
		custom_tooltip = "sector_screen.ui.block.edi.edict_piracy.desc"
		hidden_effect = {
			event_target:uiSectorCapital.sector = {
				sector_do_edict = yes
				random_country = {
					limit = { is_sector_db = yes }
						set_variable = { which = nEdictPiracy value = @monthsEdictLength }
				}
			}
		}
	}
}
ui_cb_edict_piracy_off = {
	potential = {
		exists = event_target:uiSectorCapital
		event_target:uiSectorCapital.sector = { sector_has_edict_piracy = yes }
	}
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.edict_piracy.length"
			event_target:uiSectorCapital.sector = { sector_has_edict_piracy = no }
		}		
	}
}




# UI / TOOLTIPS

# Sector edict cost tooltip
ui_tt_edict_cost = {
	potential = { exists = event_target:uiSectorDatabase }
	allow = {
		custom_tooltip = {
			fail_text = "sector_screen.ui.block.edi.cost"
			always = no
		}
		custom_tooltip = {
			success_text = "sector_screen.ui.block.edi.add1"
			event_target:uiSectorDatabase = { check_variable = { which = nEdictCostPlanets value > 0 } }
		}				
	}
}