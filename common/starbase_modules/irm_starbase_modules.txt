# IRM
# Station modules

civilian_dock = {
	icon = "GFX_starbase_civilian_dock"
	section = "HANGAR_STARBASE_SECTION"
	construction_days = 180

	cost = {
		minerals = 200
	}
	
	potential = {
		has_starbase_building = system_administration
	}

	system_modifier = {
		pop_resettlement_cost_mult = -0.10
		planet_migration_all_pull = 0.10
	}
	
	#ai_build_at_chokepoint = yes
	#ai_build_outside_chokepoint = no
	#ai_weight = {}

	#show_in_tech = "tech_mass_drivers_1"
}

reprocessing_line = {
	icon = "GFX_spaceport_module_resource_silo"
	section = "REFINERY_STARBASE_SECTION"
	construction_days = 180

	cost = {
		minerals = 200
	}

	potential = {
		has_starbase_building = system_administration
	}
	
	possible = {
		custom_tooltip = {
			fail_text = "requires_starport"
			has_starbase_size >= starbase_starport
		}
		custom_tooltip = {
			fail_text = "requires_colonized_planet"
			solar_system = {
				any_planet = {
					is_colony = yes
				}
			}
		}
		custom_tooltip = {
			fail_text = "sm_reprocessing_line_req.stations"
			solar_system = {
				any_planet = {
					or = {
						has_mining_station = yes
						#has_research_station = yes
					}
				}
			}
		}		
	}

	# Basic output
	produced_resources = {
		minerals = 1
		energy = 1
	}

	produced_resource_trigger = {
		# If there is no minerals extraction
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = minerals amount > 0 }
								}
							}
						}
						count = 0
					}
				}
			}
			resources = { minerals = -1 }
		}
		# If there is no energy extraction
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = energy amount > 0 }
								}
							}
						}
						count = 0
					}
				}
			}
			resources = { energy = -1 }
		}

		# +1 per minerals mining station
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = minerals amount > 0 }
								}
							}
						}
						count > 1
					}
				}
			}
			resources = {
				minerals = 1
			}
		}
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = minerals amount > 0 }
								}
							}
						}
						count > 2
					}
				}
			}
			resources = {
				minerals = 1
			}
		}
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = minerals amount > 0 }
								}
							}
						}
						count > 3
					}
				}
			}
			resources = {
				minerals = 1
			}
		}
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = minerals amount > 0 }
								}
							}
						}
						count > 4
					}
				}
			}
			resources = {
				minerals = 1
			}
		}

		# +1 per energy mining station
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = energy amount > 0 }
								}
							}
						}
						count > 1
					}
				}
			}
			resources = {
				energy = 1
			}
		}
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = energy amount > 0 }
								}
							}
						}
						count > 2
					}
				}
			}
			resources = {
				energy = 1
			}
		}
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = energy amount > 0 }
								}
							}
						}
						count > 3
					}
				}
			}
			resources = {
				energy = 1
			}
		}
		modifier = {
			hidden_trigger = { exists = this }		
			solar_system = {
				space_owner = {
					count_owned_ships = {
						limit = {
							is_ship_size = mining_station
							exists = fleet
							fleet = {
								exists = orbit
								orbit = {
									solar_system = { is_same_value = root.solar_system }
									has_resource = { type = energy amount > 0 }
								}
							}
						}
						count > 4
					}
				}
			}
			resources = {
				energy = 1
			}
		}

	}

	#ai_build_at_chokepoint = yes
	#ai_build_outside_chokepoint = no
	#ai_weight = {}

	#show_in_tech = "tech_mass_drivers_1"
}