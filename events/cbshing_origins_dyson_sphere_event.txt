namespace = cbshing_origins_dyson_sphere_event
# file contains Dyson Engineers Events
# by cbshing

# Triggers after getting required tech
### Gives Gateway Travel & Construction Tech Special Project
country_event = {
	id = cbshing_origins_dyson_sphere_event.1
	title = cbshing_origins_dyson_sphere_event.1.name
	desc = cbshing_origins_dyson_sphere_event.1.desc
	
	picture = GFX_evt_megastructure_construction
	show_sound = event_construction
	location = FROM
	
	is_triggered_only = yes

	trigger = { 
		is_cbshing_dyson_sphere_country = yes 
		is_ai = no
		NOT = { has_country_flag =  enabled_dyson_gateway_construction_project }
		any_system_within_border = { has_star_flag = abandoned_gateway }
		#has_country_flag = encountered_first_gateway
		has_technology = tech_starbase_5
		has_technology = tech_space_defense_station_improvement
		has_technology = tech_mega_engineering
		NOR = { 
			has_country_flag = gateway_reactivated
			has_country_flag = gateway_built
		}
	}

	immediate = {
		set_country_flag = enabled_dyson_gateway_construction_project
	}
	
	option = {
		name = "cbshing_origins_dyson_sphere_event.1.a"
		random_owned_planet = {
			limit = { is_capital = yes }
			enable_special_project = {
				name = "DYSON_GATEWAY_ENGINEERING"
				location = this
				owner = root
			}
		}
	}
}

### Gives Gateway Travel & Construction Tech to Humans Completing Special Project
country_event = {
	id = cbshing_origins_dyson_sphere_event.3
	title = cbshing_origins_dyson_sphere_event.3.name
	desc = cbshing_origins_dyson_sphere_event.3.desc
	
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	location = FROM
	
	is_triggered_only = yes

	trigger = { 
		is_cbshing_dyson_sphere_country = yes 
		is_ai = no
		has_country_flag =  enabled_dyson_gateway_construction_project
		NOT = { has_country_flag =  enabled_dyson_gateway_construction }
	}

	immediate = {
		set_country_flag = enabled_dyson_gateway_construction
	}
	
	option = {
		name = "cbshing_origins_dyson_sphere_event.3.a"
		custom_tooltip = cbshing_origins_dyson_sphere_event.3.a.tooltip
		give_technology = { tech = "tech_gateway_activation" message = no }
		give_technology = { tech = "tech_gateway_construction" message = no }
	}
}

### Gives Gateway Travel & Construction Tech to AI
country_event = {
	id = cbshing_origins_dyson_sphere_event.2
	hide_window = yes
	is_triggered_only = yes

	trigger = { 
		is_cbshing_dyson_sphere_country = yes 
		is_ai = yes
		NOT = { has_country_flag =  enabled_dyson_gateway_construction }
		any_system_within_border = { has_star_flag = abandoned_gateway }
		#has_country_flag = encountered_first_gateway
		has_technology = tech_starbase_5
		has_technology = tech_space_defense_station_improvement
		has_technology = tech_mega_engineering
		NOR = { 
			has_country_flag = gateway_reactivated
			has_country_flag = gateway_built
		}
	}

	immediate = {
		set_country_flag = enabled_dyson_gateway_construction
		give_technology = { tech = "tech_gateway_activation" message = no }
		give_technology = { tech = "tech_gateway_construction" message = no }
	}
}

#triggers ai gate activation
event = {
	id = cbshing_origins_dyson_sphere_event.10
	hide_window = yes
	is_triggered_only = yes

	trigger = { 
		years_passed >= 7
		any_country = { 
			is_cbshing_dyson_sphere_country = yes 
			is_ai = yes 
			NOT = { has_country_flag =  dyson_gateway_activated }
		}
	}

	immediate = {
		random_country = {
			limit = {
				is_cbshing_dyson_sphere_country = yes 
				is_ai = yes
				NOT = { has_country_flag =  dyson_gateway_activated }
			}
			random_list = {
				10 = {
					modifier = {
						factor = 3
						years_passed >= 10
					}
					modifier = {
						factor = 5
						years_passed >= 15
					}
					modifier = {
						factor = 10
						years_passed >= 20
					}
					country_event = { id = cbshing_origins_dyson_sphere_event.11 days = 200 random = 800 }
				}
			}
		}
	}
}
country_event = {
	id = cbshing_origins_dyson_sphere_event.11
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = dyson_gateway_activated
		this.capital_scope.solar_system = {
			random_system_megastructure  = {
				limit = { is_megastructure_type = gateway_0  }
				upgrade_megastructure_to = gateway_final   
				finish_upgrade = yes
			}
			random_megastructure = {
				limit = { is_megastructure_type = gateway_ruined }
				upgrade_megastructure_to = gateway_restored
				finish_upgrade = yes
			}
		}
		add_minerals = -5000
	}
}

#Spawn Hyperlane
event = {
	id = cbshing_origins_dyson_sphere_event.20
	hide_window = yes
	is_triggered_only = yes

	trigger = { 
		#years_passed >= 5
		any_country = { 
			is_cbshing_dyson_sphere_country = yes 
			#is_ai = yes 
		}
	}

	immediate = {
		random_list = {
			10 = {
				modifier = {
					factor = 3
					years_passed >= 7
				}
				modifier = {
					factor = 5
					years_passed >= 10
				}
				modifier = {
					factor = 10
					years_passed >= 15
				}
				random_system = {
					limit = {
						OR = {
							has_megastructure = cbshing_origins_dyson_sphere_0
							has_megastructure = cbshing_origins_dyson_sphere_1 
							has_megastructure = cbshing_origins_dyson_sphere_2 
							has_megastructure = cbshing_origins_dyson_sphere_3 
							has_megastructure = cbshing_origins_dyson_sphere_4
							has_megastructure = cbshing_origins_dyson_sphere_5
						}
						NOT = { has_star_flag = dyson_star_hyperlane_spawned }
					}
					set_star_flag = dyson_star_hyperlane_spawned
					this = { save_event_target_as = dyson_engineer_star }
					random_neighbor_system  = { 
						ignore_hyperlanes = yes
						add_hyperlane = { from = this to = event_target:dyson_engineer_star }
					}
					if = { 
						limit = { 
							exists = owner 
							owner = { is_ai = no }
							owner = { NOT = { has_country_flag = dyson_hyperlane_spawned } }
						}
						owner = { country_event = { id = cbshing_origins_dyson_sphere_event.22 days = -1 } }
					}						
				}
			}
		}
	}
}

country_event = {
	id = cbshing_origins_dyson_sphere_event.21
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_system = {
			limit = {
				OR = {
					has_megastructure = cbshing_origins_dyson_sphere_0
					has_megastructure = cbshing_origins_dyson_sphere_1 
					has_megastructure = cbshing_origins_dyson_sphere_2 
					has_megastructure = cbshing_origins_dyson_sphere_3 
					has_megastructure = cbshing_origins_dyson_sphere_4
					has_megastructure = cbshing_origins_dyson_sphere_5
				}
				NOT = { has_star_flag = dyson_star_hyperlane_spawned }
			}
			set_star_flag = dyson_star_hyperlane_spawned
			this = { save_event_target_as = dyson_engineer_star }
			random_neighbor_system  = { 
				ignore_hyperlanes = yes
				add_hyperlane = { from = this to = event_target:dyson_engineer_star }
			}
			if = { 
				limit = { 
					exists = owner 
					owner = { is_ai = no }
					owner = { NOT = { has_country_flag = dyson_hyperlane_spawned } }
				}
				owner = { country_event = { id = cbshing_origins_dyson_sphere_event.22 days = -1 } }
			}						
		}
	}
}

#country_event = {
#	id = cbshing_origins_dyson_sphere_event.20
#	hide_window = yes
#	is_triggered_only = yes
#
#	trigger = { 
#		is_cbshing_dyson_sphere_country = yes 
#		NOT = { has_country_flag =  dyson_hyperlane_spawned }
#		last_increased_tech = tech_hyper_drive_2 
#	}
#
#	immediate = {
#		if = {
#			limit = { is_ai = yes }
#			country_event = { id = cbshing_origins_dyson_sphere_event.21 days = 1 random = 720 }
#			else = {
#				country_event = { id = cbshing_origins_dyson_sphere_event.22 days = 1 random = 720 }
#			}
#		}
#	}
#}

#country_event = {
#	id = cbshing_origins_dyson_sphere_event.21
#	hide_window = yes
#	is_triggered_only = yes
#
#	immediate = {
#		set_country_flag = dyson_hyperlane_spawned
#		random_system_within_border = {
#			limit = {
#				OR = {
#					has_megastructure = cbshing_origins_dyson_sphere_0
#					has_megastructure = cbshing_origins_dyson_sphere_1 
#					has_megastructure = cbshing_origins_dyson_sphere_2 
#					has_megastructure = cbshing_origins_dyson_sphere_3 
#					has_megastructure = cbshing_origins_dyson_sphere_4
#					has_megastructure = cbshing_origins_dyson_sphere_5
#				}
#				any_planet = { is_homeworld = yes }
#			}
#			this = { save_event_target_as = dyson_home_star }
#			random_neighbor_system  = { 
#				ignore_hyperlanes = yes
#				add_hyperlane = { from = this to = event_target:dyson_home_star }
#			} 
#		}
#	}
#}


country_event = {
	id = cbshing_origins_dyson_sphere_event.22
	title = cbshing_origins_dyson_sphere_event.22.name
	desc = cbshing_origins_dyson_sphere_event.22.desc
	
	picture = GFX_evt_federation_fleet
	show_sound = event_mystic_reveal
	location = FROM
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = dyson_hyperlane_spawned
	}
	
	option = {
		name = "cbshing_origins_dyson_sphere_event.22.a"
	}
}


#Hyperlane spawning event
event = {
	id = cbshing_origins_dyson_sphere_event.30
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		#mid_game_years_passed >= 5
		years_passed >= 1
		NOT = { has_global_flag = galactic_hyperlane_spawning_happened }
		any_country = { is_cbshing_dyson_sphere_country = yes  }
	}

	immediate = {
		random_country = {
			limit = { is_country_type = global_event }
			random_list = {
				10 = {
					modifier = {
						factor = 0
						any_country = { 
							is_country_type = default 
							is_cbshing_dyson_sphere_country = yes
							NOR = {
								has_megastructure = cbshing_origins_dyson_sphere_1
								has_megastructure = cbshing_origins_dyson_sphere_2
								has_megastructure = cbshing_origins_dyson_sphere_3
								has_megastructure = cbshing_origins_dyson_sphere_4
								has_megastructure = cbshing_origins_dyson_sphere_5
							}
						}
					}
					modifier = {
						factor = 1.5
						any_country = { 
							is_country_type = default 
							NOT = { is_cbshing_dyson_sphere_country = yes  }
							OR = {
								has_megastructure = cbshing_origins_dyson_sphere_1
								has_megastructure = cbshing_origins_dyson_sphere_2
								has_megastructure = cbshing_origins_dyson_sphere_3
								has_megastructure = cbshing_origins_dyson_sphere_4
								has_megastructure = cbshing_origins_dyson_sphere_5
							}
						}
					}
					modifier = {
						factor = 2
						any_country = { 
							is_country_type = default 
							is_cbshing_dyson_sphere_country = yes 
							is_ai = yes
						}
					}
					modifier = {
						factor = 4
						any_country = { 
							is_country_type = default 
							is_cbshing_dyson_sphere_country = yes 
							has_technology = "tech_psi_jump_drive_1"
						}
					}
					country_event = { id = cbshing_origins_dyson_sphere_event.31 days = 1 }
					set_global_flag = galatic_hyperlane_spawning_happened
				}
				100 = { }
			}
		}
	}
}

country_event = {
	id = cbshing_origins_dyson_sphere_event.31
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
			}
			country_event = { id = cbshing_origins_dyson_sphere_event.32 }
		}
		hidden_effect = { country_event = { id = cbshing_origins_dyson_sphere_event.34 days = 30 } }
	}
}

country_event = {
	id = cbshing_origins_dyson_sphere_event.32
	title = "cbshing_origins_dyson_sphere_event.32.name"
	desc = "cbshing_origins_dyson_sphere_event.32.desc"
	picture = GFX_evt_physics_research
	show_sound = event_alien_signal

	is_triggered_only = yes

	option = {
		name = cbshing_origins_dyson_sphere_event.32.a
		hidden_effect = { country_event = { id = cbshing_origins_dyson_sphere_event.33 days = 30 } }
	}
}

country_event = {
	id = cbshing_origins_dyson_sphere_event.33
	title = "cbshing_origins_dyson_sphere_event.33.name"
	desc = "cbshing_origins_dyson_sphere_event.33.desc"
	picture = GFX_evt_wormhole
	show_sound = event_alien_signal

	is_triggered_only = yes

	option = {
		name = WORRYING
	}
}

country_event = {
	id = cbshing_origins_dyson_sphere_event.34
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		every_system = {
			limit = { 
				OR = {
					has_megastructure = cbshing_origins_dyson_sphere_1
					has_megastructure = cbshing_origins_dyson_sphere_2
					has_megastructure = cbshing_origins_dyson_sphere_3
					has_megastructure = cbshing_origins_dyson_sphere_4
					has_megastructure = cbshing_origins_dyson_sphere_5
				} 
				NOT = { has_star_flag = dyson_hyperlane_star }
			}
			add_dyson_neighbor_hyperlane = yes
			set_star_flag = dyson_hyperlane_star 		
		}
		while = {
			count = 50
			random_system = {
				limit = { 
					NOT = { has_star_flag = dyson_hyperlane_star }
				}
				remove_dyson_neighbor_hyperlanes = yes 
				add_dyson_neighbor_hyperlane = yes
				add_dyson_neighbor_hyperlane = yes
				set_star_flag = dyson_hyperlane_star 
				set_star_flag = dyson_hyperlane_star_main 
			}
		}
	}
}