namespace = sms_start

event = {
    id = sms_start.0
    hide_window = yes
    fire_only_once = yes

    immediate = {
        every_country = {
            limit = {
                has_civic = civic_sms
            }
			country_event = { id = sms_start.1 }
        }
    }
}

country_event = {
    id = sms_start.1
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        give_technology = { 
            message = no 
            tech = tech_hyper_drive_2 
        }
        give_technology = { 
            message = no 
            tech = tech_hyper_drive_3 
        }
        give_technology = { 
            message = no 
            tech = tech_gateway_construction 
        }
        give_technology = { 
            message = no 
            tech = tech_gateway_activation 
        }
        give_technology = { 
            message = no 
            tech = tech_wormhole_stabilization 
        }
        give_technology = {
            message = no
            tech = tech_automated_exploration
        }
        this.capital_scope.solar_system = {
            set_star_flag = sms_home_system
            random_neighbor_system = {
                ignore_hyperlanes = yes
                set_star_flag = sms_wh_system
                save_event_target_as = sms_wh_system
            }
			spawn_megastructure = { 
				type = gateway_ruined 
				random_pos = yes
				orbit_angle = 360
				owner = FROMFROM
            }
        }
        country_event = { id = sms_start.2 }
    }
}

country_event = {
	id = sms_start.2
	hide_window = yes
	is_triggered_only = yes

	immediate = {
        random_system = {
            limit = {
                NOR = {
                    has_natural_wormhole = yes
                    starting_system = yes
                    has_star_flag = empire_cluster
                }
                distance = {
                    source = event_target:sms_wh_system
                    min_distance = 200
                }
            }
            set_star_flag = sms_wh_target
            event_target:sms_wh_system = {
                    spawn_natural_wormhole = {
                        random_pos = yes
                        orbit_angle = 360
                    }
                    set_star_flag = sms_tried_wh
                }
            spawn_natural_wormhole = {
                random_pos = yes
                orbit_angle = 360
            }
            set_star_flag = sms_wh_target_spawned
            link_wormholes = event_target:sms_wh_system
        }
    }
}